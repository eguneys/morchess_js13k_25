const t=""+new URL("sprites_with_bg_alpha_working-CJbDibjU.png",import.meta.url).href;function e(t,e){let[i,o,n,s]=t,[r,l,a,c]=e;return i<r+a&&i+n>r&&o<l+c&&o+s>l}function i(t){let e,i,o,n,s,r=!1,l=0;function a(e){return[e[0]*t.width,e[1]*t.height]}return function(t,e){const i=t=>{let[e,i]=(t=>{if(t.clientX||0===t.clientX)return[t.clientX,t.clientY]})(t)??[0,0];return[(e-o.left)/o.width,(i-o.top)/o.height]};let o,n=t.getContext("2d");function s(){o=t.getBoundingClientRect(),n.imageSmoothingEnabled=!1}function r(){s()}s(),t.addEventListener("pointerdown",function(o){t.setPointerCapture(o.pointerId);let n=i(o);e.on_down(n)},{passive:!1}),t.addEventListener("pointermove",function(t){let o=i(t);e.on_move(o)},{passive:!1}),document.addEventListener("pointerup",function(t){let o=i(t);e.on_up(o)}),new ResizeObserver(s).observe(t),document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0})}(t,{on_down(t){t=a(t),o=void 0,i=t,n=t,r=!1},on_up(t){t=a(t),i=void 0,e=void 0,o=t},on_move(t){t=a(t),e=t,r=!0}}),{get is_hovering(){return e},get is_down(){return i},get is_up(){return o},get is_just_down(){return n},get is_double_click(){return s},get has_moved_after_last_down(){return r},update(t){var e,i,r;s=void 0,n&&l>0&&(s=n,l=0),r=t,l=(e=l)<(i=0)?Math.min(e+r,i):e>i?Math.max(e-r,i):e,n=void 0,o=void 0}}}let o=440*Math.pow(Math.pow(2,1/12),-9),n=/^[0-9.]+$/,s=/\s+/,r=/(\d+)/,l={};"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){l[t]=e})});class a{frequency;duration;constructor(t){let e=t.split(s);var i;this.frequency=function(t){var e=t.split(r),i=l[e[0]],n=(parseInt(e[1])||4)-4;return o*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,n)}(e[0])||0,this.duration=(i=e[1],(n.test(i)?parseFloat(i):i.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0))||0)}}class c{cx;tempo;notes;loop;smoothing;staccato;eqs;gain;osc;wave_type;constructor(t,e=120,i=[],o=!0){this.cx=t,this.tempo=e,this.osc=null,this.create_fx_nodes(),this.loop=o,this.smoothing=0,this.staccato=0,this.notes=[],this.push(i)}push(t){this.notes.push(...t.map(t=>new a(t)))}create_fx_nodes(){var t=this.gain=this.cx.createGain();return this.eqs={bass:void 0,mid:void 0,treble:void 0},[["bass",100],["mid",1e3],["treble",2500]].forEach(e=>{let i=this.eqs[e[0]]=this.cx.createBiquadFilter();i.type="peaking",i.frequency.value=e[1],t.connect(t=i)}),t.connect(this.cx.destination),this}create_oscillator(){return this.stop(),this.osc=this.cx.createOscillator(),this.osc.type=this.wave_type||"square",this.osc.connect(this.gain),this}schedule_note(t,e){var i=60/this.tempo*this.notes[t].duration,o=i*(1-(this.staccato||0));return this.set_frequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,o),this.set_frequency(0,e+o),e+i}get_next_note(t){return this.notes[t<this.notes.length-1?t+1:0]}get_slide_start_delay(t){return t-Math.min(t,60/this.tempo*this.smoothing)}slide(t,e,i){var o=this.get_next_note(t),n=this.get_slide_start_delay(i);return this.set_frequency(this.notes[t].frequency,e+n),this.ramp_frequency(o.frequency,e+i),this}set_frequency(t,e){return this.osc.frequency.setValueAtTime(t,e),this}ramp_frequency(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this}play(t){return t="number"==typeof t?t:this.cx.currentTime,this.create_oscillator(),this.osc.start(t),this.notes.forEach((e,i)=>{t=this.schedule_note(i,t)}),this.osc.stop(t),this.osc.onended=this.loop?()=>this.play(t):null,this}stop(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this}}let h=new AudioContext;h.currentTime;let u=[],f=[],d=[];u=["B4 q","C5 q","E5 h","E5 q","F5 q","B4 h","D5 q","C5 q","B4 h","B4 q","B4 q","A4 h","B4 q","C5 q","D5 h","B4 q","C5 q","D5 h","E5 q","D5 q","B4 h","B4 q","B4 q","A4 h"],f=["- q","E4 h","C4 q","G4 h","E4 q","- q","- h","E4 q","C4 q","G4 q","E4 h","- q"],d=["- h","- q","A2 q","- h","- q","D3 q","- h","- q","A2 q"];let p=new c(h,96,u),b=new c(h,96,f),_=new c(h,96,d);p.staccato=.55,b.staccato=.55,_.staccato=.6,_.smoothing=.01,p.gain.gain.value=.9,b.gain.gain.value=.8,_.gain.gain.value=.44,p.eqs.mid.frequency.value=800,p.eqs.mid.gain.value=3,b.eqs.mid.frequency.value=1200,b.eqs.mid.gain.value=3,_.eqs.bass.gain.value=6,_.eqs.bass.frequency.value=80,_.eqs.mid.gain.value=-6,_.eqs.mid.frequency.value=500,_.eqs.treble.gain.value=-2,_.eqs.treble.frequency.value=1400;const w=t=>(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),k=t=>(t=t>>>8&16711935|(16711935&t)<<8)>>>16&65535|(65535&t)<<16,m=t=>k(t=(t=(t=t>>>1&1431655765|(1431655765&t)<<1)>>>2&858993459|(858993459&t)<<2)>>>4&252645135|(252645135&t)<<4);class g{lo;hi;constructor(t,e){this.lo=0|t,this.hi=0|e}static fromSquare(t){return t>=32?new g(0,1<<t-32):new g(1<<t,0)}static fromRank(t){return new g(255,0).shl64(8*t)}static fromFile(t){return new g(16843009<<t,16843009<<t)}static empty(){return new g(0,0)}static full(){return new g(4294967295,4294967295)}static corners(){return new g(129,2164260864)}static center(){return new g(402653184,24)}static backranks(){return new g(255,4278190080)}static backrank(t){return"white"===t?new g(255,0):new g(0,4278190080)}static lightSquares(){return new g(1437226410,1437226410)}static darkSquares(){return new g(2857740885,2857740885)}complement(){return new g(~this.lo,~this.hi)}xor(t){return new g(this.lo^t.lo,this.hi^t.hi)}union(t){return new g(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new g(this.lo&t.lo,this.hi&t.hi)}diff(t){return new g(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?g.empty():t>=32?new g(this.hi>>>t-32,0):t>0?new g(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?g.empty():t>=32?new g(0,this.lo<<t-32):t>0?new g(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new g(k(this.hi),k(this.lo))}rbit64(){return new g(m(this.hi),m(this.lo))}minus64(t){const e=this.lo-t.lo,i=(e&t.lo&1)+(t.lo>>>1)+(e>>>1)>>>31;return new g(e,this.hi-(t.hi+i))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return w(this.lo)+w(this.hi)}isEmpty(){return 0===this.lo&&0===this.hi}nonEmpty(){return 0!==this.lo||0!==this.hi}has(t){return 0!=(t>=32?this.hi&1<<t-32:this.lo&1<<t)}set(t,e){return e?this.with(t):this.without(t)}with(t){return t>=32?new g(this.lo,this.hi|1<<t-32):new g(this.lo|1<<t,this.hi)}without(t){return t>=32?new g(this.lo,this.hi&~(1<<t-32)):new g(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new g(this.lo,this.hi^1<<t-32):new g(this.lo^1<<t,this.hi)}last(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}first(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}withoutFirst(){return 0!==this.lo?new g(this.lo&this.lo-1,this.hi):new g(0,this.hi&this.hi-1)}moreThanOne(){return 0!==this.hi&&0!==this.lo||!!(this.lo&this.lo-1)||!!(this.hi&this.hi-1)}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,e=this.hi;for(;0!==t;){const e=31-Math.clz32(t&-t);t^=1<<e,yield e}for(;0!==e;){const t=31-Math.clz32(e&-e);e^=1<<t,yield 32+t}}*reversed(){let t=this.lo,e=this.hi;for(;0!==e;){const t=31-Math.clz32(e);e^=1<<t,yield 32+t}for(;0!==t;){const e=31-Math.clz32(t);t^=1<<e,yield e}}}const y=t=>t>>3,v=t=>7&t,q=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,C=(t,e)=>{let i=g.empty();for(const o of e){const e=t+o;0<=e&&e<64&&Math.abs(v(t)-v(e))<=2&&(i=i.with(e))}return i},x=t=>{const e=[];for(let i=0;i<64;i++)e[i]=t(i);return e},$=x(t=>C(t,[-9,-8,-7,-1,1,7,8,9])),M=x(t=>C(t,[-17,-15,-10,-6,6,10,15,17])),E={white:x(t=>C(t,[7,9])),black:x(t=>C(t,[-7,-9]))},L=x(t=>g.fromFile(v(t)).without(t)),T=x(t=>g.fromRank(y(t)).without(t)),z=x(t=>{const e=new g(134480385,2151686160),i=8*(y(t)-v(t));return(i>=0?e.shl64(i):e.shr64(-i)).without(t)}),B=x(t=>{const e=new g(270549120,16909320),i=8*(y(t)+v(t)-7);return(i>=0?e.shl64(i):e.shr64(-i)).without(t)}),A=(t,e,i)=>{let o=i.intersect(e),n=o.bswap64();return o=o.minus64(t),n=n.minus64(t.bswap64()),o.xor(n.bswap64()).intersect(e)},j=(t,e)=>{const i=g.fromSquare(t);return A(i,z[t],e).xor(A(i,B[t],e))},S=(t,e)=>((t,e)=>A(g.fromSquare(t),L[t],e))(t,e).xor(((t,e)=>{const i=T[t];let o=e.intersect(i),n=o.rbit64();return o=o.minus64(g.fromSquare(t)),n=n.minus64(g.fromSquare(63-t)),o.xor(n.rbit64()).intersect(i)})(t,e)),F=(t,e,i)=>{switch(t.role){case"pawn":return((t,e)=>E[t][e])(t.color,e);case"knight":return(t=>M[t])(e);case"bishop":return j(e,i);case"rook":return S(e,i);case"queen":return((t,e)=>j(t,e).xor(S(t,e)))(e,i);case"king":return(t=>$[t])(e)}};function O(t){let e=function(t){t=t.split(" ")[0];let e={},i=7;for(let o of t.split("/")){let t=0;for(let n of o)if(G(n)){let o=q(t,i);if(void 0!==o){let t=n,i=2;for(;void 0!==e[t];)t=n+i,i++;e[t]=o}t+=1}else t+=parseInt(n);i-=1}return e}(t);return function(t){let e=[],i=function(t){let e=[],i=function(t){let e=g.empty();for(let i of Object.keys(t))e=e.set(t[i],!0);return e}(t);for(let o of Object.keys(t)){let n=K(o),s=t[o],r=F(n,s,i);for(let l of r)for(let a of Object.keys(t))if(t[a]===l){let l,c=t[a],h=i.without(c),u=F(n,s,h).diff(r);for(let e of u)for(let i of Object.keys(t))t[i]===e&&(l=i);void 0!==l?e.push([o,a,l]):e.push([o,a])}}return e}(t);for(let o of Object.keys(t)){let t=[],n=[],s=[],r=[],l=[];for(let e of i)e[0]===o?2===e.length?t.push(e[1]):r.push([e[1],e[2]]):e[1]===o?2===e.length?n.push(e[0]):s.push([e[0],e[2]]):e[2]===o&&l.push([e[0],e[1]]);e.push({p1:o,attacks:t,attacked_by:n,blocks:s,blocked_attacks:r,blocked_attacked_by:l})}return e}(e)}const D=t=>!t.attacked_by.find(t=>t.toLowerCase()===t)&&!t.blocked_attacked_by.find(t=>t[0].toLowerCase()===t[0])&&!t.blocks.find(t=>t[0].toLowerCase()===t[0]),R=t=>!t.attacked_by.find(t=>t.toLowerCase()!==t)&&!t.blocked_attacked_by.find(t=>t[0].toLowerCase()!==t[0])&&!t.blocks.find(t=>t[0].toLowerCase()!==t[0]);const I={r:"rook",n:"knight",b:"bishop",p:"pawn",q:"queen",k:"king"};function G(t){return void 0!==I[t.toLowerCase()]}function K(t){var e;return{color:(e=t).toLowerCase()===e?"black":"white",role:I[t.toLowerCase().replace(/[2345678]/,"")]}}console.log(O("8/8/4r3/8/8/4P3/4K3/8 w - - 0 1").map(function(t){let e=t.p1,i=t.attacks.map(t=>`+${t}`).join(" "),o=t.attacked_by.map(t=>`${t}+`).join(" "),n=t.blocks.map(t=>`${t[0]}+|${t[1]}`).join(" "),s=t.blocked_attacks.map(t=>`+${t[0]}/${t[1]}`).join(" "),r=t.blocked_attacked_by.map(t=>`${t[0]}+/${t[1]}`).join(" "),l=[e];return D(t)&&l.push("z+"),R(t)&&l.push("Z+"),""!==i&&l.push(i),""!==o&&l.push(o),""!==n&&l.push(n),""!==s&&l.push(s),""!==r&&l.push(r),l.join(" ")}));let P,U,X,N,V=await function(t){let e=new Image;return new Promise(i=>{e.onload=()=>i(e),e.src=t})}(t);function J(t,e,i,o=1,n=o){let s,r,l;e=Math.floor(e),i=Math.floor(i),t<4?(s=32,r=32*t,l=0):t<28?(s=16,r=(t-=4)%8*16,l=32+16*Math.floor(t/8)):(s=8,r=(t-=28)%16*8,l=80+8*Math.floor(t/16)),U.drawImage(V,r,l,s,s,e,i,s*o,s*n)}function Q(t){N.font="42px Arial";let e=1308,i=803.25;W(t[0],e,i,600,60),N.font="28px Arial",e=1308,i=1039.5,W(t[1],e,i,600,60)}function W(t,e,i,o,n){const s=t.split(" ");let r="",l=i;for(let a=0;a<s.length;a++){const t=r+s[a]+" ";N.measureText(t).width>o&&a>0?(N.fillText(r,e,l),r=s[a]+" ",l+=n):r=t}N.fillText(r,e,l)}function Y(){N.clearRect(0,0,1920,1080),U.fillRect(0,0,320,180),J(110,0,0,320);let t=10,e=24;for(let o=0;o<8;o++)for(let i=0;i<8;i++){J(108+((o+i)%2==1?1:0),t+3.5*o*8,e+3.5*i*8,3.5)}t=10,e=0,J(111,t,e,28,3),e=248,J(111,t,e,28,3);for(let o of xt)J(ft(o.piece),...o.pos,3),o.piece.match(/2/)&&J(82,...o.pos,3),o.is_hovering&&J(112,...o.pos,3);J(111,318,188,20,10),Q(St||(At||(jt||Bt))),J(111,238,2,30,23);let i=qt.find(t=>t.is_hovering);if(i){let[t,e,o,n]=i.bb;U.strokeRect(t,e,o,n);for(let s of i.circles)J(112,...s,3);for(let s of i.no_arrows)it(s[0],s[1],"red");for(let s of i.yes_arrows)it(s[0],s[1],"green")}for(let o of vt)J(o[0],o[1],o[2]);if(Ct&&J(ft(Ct.piece),...Ct.pos,3),void 0!==At){!function(t,e,i,o){for(let n=0;n<e;n++)J(t+n,i+8*n*2,o,2)}(119,5,400,246+(Ot&&Ft%500<200?2:0))}if(function(){let t=tt,e=et;J(111,238,188,9.8,10);let i=Lt[Et];N.font="bold 64px Arial",N.fillText(`${i.chapter}-${i.level}`,265*t,204*e);let o=Ft%500<250?3:0,n=Rt?o:0;J(117,242-(Dt?o:0),190,2),J(118,296+n,190,2)}(),J(28,...Mt),It){let t=80*Math.sin(.008*Ft),e=80*Math.sin(.008*Ft),i=80*Math.sin(.003*Ft);N.font="bold 180px Arial",N.fillText("Mor",200+t,400+e),N.fillText("Chess",1e3-t,400+e),N.fillText("Black",200,800-.1*i),N.fillText("Cat",800,800-.1*i)}}const Z=[242,190,16,16],H=[296,190,16,16],tt=4,et=4;function it(t,e,i){N.lineWidth=10,N.strokeStyle=i,N.lineCap="round",N.beginPath(),N.moveTo(t[0]*tt,t[1]*et),N.lineTo(e[0]*tt,e[1]*et),N.stroke()}const ot=[400,246,80,16];function nt(t,e){if(t.p1!==e.p1)return!1;if(t.attacks.length!==e.attacks.length)return!1;for(let i of t.attacks)if(!t.attacks.find(t=>t===i))return!1;if(t.attacked_by.length!==e.attacked_by.length)return!1;for(let i of t.attacked_by)if(!t.attacked_by.find(t=>t===i))return!1;if(t.blocks.length!==e.blocks.length)return!1;for(let i of t.blocks)if(!e.blocks.find(t=>t[0]===i[0]&&t[1]===i[1]))return!1;if(t.blocked_attacks.length!==e.blocked_attacks.length)return!1;for(let i of t.blocked_attacks)if(!e.blocked_attacks.find(t=>t[0]===i[0]&&t[1]===i[1]))return!1;if(t.blocked_attacked_by.length!==e.blocked_attacked_by.length)return!1;for(let i of t.blocked_attacked_by)if(!e.blocked_attacked_by.find(t=>t[0]===i[0]&&t[1]===i[1]))return!1;return!0}const st=(t,e,i)=>vt.push([t,e,i,0]),rt=(t,e,i,o,n,s,r,l)=>qt.push({info:t,bb:[e,i,o,n],is_hovering:!1,circles:s,yes_arrows:r,no_arrows:l});function lt(t,e,i){const o=t=>xt.filter(e=>e.piece===t&&void 0!==bt(e.pos)).map(t=>t.pos),n=(t,e)=>{let i=xt.filter(e=>e.piece===t&&void 0!==bt(e.pos)).map(t=>t.pos)[0],o=xt.filter(t=>t.piece===e&&void 0!==bt(t.pos)).map(t=>t.pos)[0];if(i&&o){return[[[i[0]+12,i[1]+12],[o[0]+12,o[1]+12]]]}return[]};let s=[],r=[],l=[];const a=(t,e,i,o,n)=>{rt(t,e,i,o,n,s,r,l),s=[],r=[],l=[]},c=st;c(ft(t.p1),e+4,i+4),t.p1.match(/2/)&&c(82,e+4,i+4),s=o(t.p1),a(at.yes_piece(t.p1),e+2,i+2,12,12),c(39,(e+=8)+4,i+4),e+=8;let h=wt();if(D(t)){let r=h.find(e=>e.p1===t.p1),u=r?.attacked_by.filter(t=>t.toLowerCase()===t)??[];u=u.concat(r?.blocks.map(t=>t[0]).filter(t=>t.toLowerCase()===t)??[]),l=[...u.flatMap(e=>n(t.p1,e))],t.p1.toLowerCase()===t.p1?c(33,e+4,i+4):c(32,e+4,i+4),s=o(t.p1),a(at.zero_attacked_by_lower(t.p1),e+2,i+2,12,12),e+=12}if(R(t)){let r=h.find(e=>e.p1===t.p1),u=r?.attacked_by.filter(t=>t.toLowerCase()!==t)??[];u=u.concat(r?.blocks.map(t=>t[0]).filter(t=>t.toLowerCase()!==t)??[]),l=[...u.flatMap(e=>n(t.p1,e))],t.p1.toLowerCase()===t.p1?c(32,e+4,i+4):c(33,e+4,i+4),s=o(t.p1),a(at.zero_attacked_by_upper(t.p1),e+2,i+2,12,12),e+=12}for(let u of t.attacks){c(35,e+2,i+4);let o=h.find(e=>e.p1===t.p1);0===(o?.attacks.filter(t=>t===u)??[]).length?l=[...n(t.p1,u)]:r=[...n(t.p1,u)],a(at.attacks(t.p1,u),e+4,i+2,14,12),e+=5,c(ft(u),e+4,i+4),u.match(/2/)&&c(82,e+4,i+4),e+=9}for(let u of t.attacked_by){c(ft(u),e+4,i+4),u.match(/2/)&&c(82,e+4,i+4);let f=h.find(e=>e.p1===t.p1);0===(f?.attacked_by.filter(t=>t===u)??[]).length?l=[...n(t.p1,u)]:r=[...n(t.p1,u)],s=o(t.p1),a(at.attacked_by(t.p1,u),e+4,i+2,14,12),c(34,(e+=9)+2,i+4),e+=5}for(let u of t.blocks){c(ft(u[1]),e+4,i+4),u[1].match(/2/)&&c(82,e+4,i+4);let o=h.find(e=>e.p1===t.p1);0===(o?.blocks.filter(t=>t[0]===u[0]&&t[1]===u[1])??[]).length?l=[...n(u[0],u[1]),...n(t.p1,u[1])]:r=[...n(u[0],u[1])],a(at.blocks(t.p1,...u),e+4,i+2,24,12),c(36,(e+=9)+2,i+4),e+=5,c(ft(u[0]),e+4,i+4),u[0].match(/2/)&&c(82,e+4,i+4),e+=9}for(let u of t.blocked_attacks){c(ft(u[1]),e+4,i+4),u[0].match(/2/)&&c(82,e+4,i+4);let o=h.find(e=>e.p1===t.p1);0===(o?.blocked_attacks.filter(t=>t[0]===u[0]&&t[1]===u[1])??[]).length?l=[...n(u[0],u[1]),...n(t.p1,u[1])]:r=[...n(t.p1,u[1])],a(at.blocked_attacks(t.p1,u[1],u[0]),e+4,i+2,24,12),c(37,(e+=9)+2,i+4),e+=5,c(ft(u[0]),e+4,i+4),u[0].match(/2/)&&c(82,e+4,i+4),e+=9}for(let u of t.blocked_attacked_by){c(ft(u[1]),e+4,i+4),u[1].match(/2/)&&c(82,e+4,i+4);let o=h.find(e=>e.p1===t.p1);0===(o?.blocked_attacked_by.filter(t=>t[0]===u[0]&&t[1]===u[1])??[]).length?l=[...n(u[0],u[1]),...n(t.p1,u[1])]:r=[...n(t.p1,u[0])],a(at.blocked_attacked_by(t.p1,u[0],u[1]),e+4,i+2,24,12),c(38,(e+=9)+2,i+4),e+=5,c(ft(u[0]),e+4,i+4),u[0].match(/2/)&&c(82,e+4,i+4),e+=9}return[e,i]}const at={welcome0:["welcome to mor chess; drag pieces onto the board, but there are some rules above. hover over them for details.","drag off of the board to remove a piece."],welcome1:["each chapter; introduces a position progressively by revealing more of it's pieces","to keep your memory fresh."],welcome2:["chess tactics; are born out of relationships.","entangle them is our job."],well_done:["Congratulations, you satisfied all rules. Time to go deeper.","Click Next to continue."],well_end:["the end; chess is fascinating isn't it, go play some chess.","Thank's for playing"],equals:t=>["left side is the goal, right side is the board; your goal is to match them equal.",`this rule ${t?"has matched correctly.":"has not been matched yet."}`],no_piece:t=>[`${ut(t)} hasn't been placed yet.`,""],yes_piece:t=>[`A ${ut(t)} on the board.`,""],zero_attacked_by_lower(t){let e=t.toLowerCase()===t?"defenders":"attackers";return[`${ut(t)} has zero ${e}.`,""]},zero_attacked_by_upper(t){let e=t.toLowerCase()===t?"attackers":"defenders";return[`${ut(t)} has zero ${e}.`,""]},attacks(t,e){let i=ut(t),o=ut(e);return[`${i} is ${ct(t,e)} ${o}.`,""]},attacked_by(t,e){let i=ut(t),o=ut(e);return[`${i} is ${ht(t,e)} by ${o}.`,""]},blocks(t,e,i){let o=ut(t),n=ut(e),s=ut(i);return[`${o} blocks ${n} ${ct(e,i)} ${s}.`,""]},blocked_attacks(t,e,i){let o=ut(t),n=ut(e),s=ut(i);return[`${o} is ${ct(t,e)} ${n}, but that's blocked by ${s}.`,""]},blocked_attacked_by(t,e,i){let o=ut(t),n=ut(e),s=ut(i);return[`${o} is ${ht(t,e)} by ${n}, but that's blocked by ${s}.`,""]}},ct=(t,e)=>t.toLowerCase()===t==(e.toLowerCase()===e)?"defending":"attacking",ht=(t,e)=>t.toLowerCase()===t==(e.toLowerCase()===e)?"defended":"attacked";function ut(t){let e=K(t),i=t.match(/2/)?"2":"";return e.role[0].toUpperCase()+e.role.slice(1)+i}function ft(t){let e=K(t);return 76+{pawn:0,rook:1,bishop:2,knight:3,queen:4,king:5}[e.role]+("white"===e.color?16:0)}function dt(t){if(Ft+=t,$t.is_hovering){Mt=$t.is_hovering;for(let t of xt)t.is_hovering=!1;for(let t of xt)if(e(mt(t),kt(Mt))){t.is_hovering=!0;break}if(void 0!==Ct)Ct.pos=[Mt[0]-4,Mt[1]-4];else{for(let t of qt)t.is_hovering=!1;for(let t of qt)e(t.bb,kt(Mt))&&(t.is_hovering=!0)}Ot=void 0!==At&&e(ot,kt(Mt)),Dt=e(Z,kt(Mt)),Rt=e(H,kt(Mt))}if($t.is_just_down){let t=xt.find(t=>t.is_hovering);if(t){t.is_dragging=!0,Ct=gt(t.piece,t.pos),bt(t.pos)&&(Ct.orig=t)}}if($t.is_up){if(Ct){if(Ct.orig){let t=Ct.orig.pos;xt=xt.filter(e=>!(e.pos[0]===t[0]&&e.pos[1]===t[1]))}let t=bt($t.is_up);if(t){let e=function(t){let e=[10+3.5*t[0]*8+2,24+3.5*t[1]*8+4];return e}(t);xt=xt.filter(t=>!(t.pos[0]===e[0]&&t.pos[1]===e[1])),xt.push(gt(Ct.piece,e))}!function(){for(let t of xt){let e=bt(t.pos);if(!e)continue;let i=xt.find(i=>{if(i!==t&&i.piece[0]===t.piece[0]){let t=bt(i.pos);if(t){let i=q(...e);if(q(...t)<i)return!0}}})?"2":"";t.piece=t.piece[0]+i}}(),Ct=void 0,yt=!0}Ot&&pt(0),Dt&&pt(-1),Rt&&pt(1)}if(yt){yt=!1,vt=[],qt=[];let t=zt(),e=wt(),i=!0,o=2;for(let n of t){let t=238;[t,o]=lt(n,t,o);let s=e.find(t=>t.p1===n.p1),r=void 0!==s&&nt(n,s)?30:29;i=i&&30===r,st(r,t+4,o+4),rt(at.equals(30===r),t+2,o+2,12,12,[],[],[]),t+=10,void 0===s?(st(31,t+4,o+4),rt(at.no_piece(n.p1),t+2,o+2,12,12,[],[],[])):[t,o]=lt(s,t,o),o+=14,t=182}i?(Lt[Et].is_solved=!0,Et<Lt.length-1?-1===Lt.findIndex(t=>!t.is_solved)?It=!0:At=at.well_done:-1===Lt.findIndex(t=>!t.is_solved)?It=!0:At=at.well_end):At=void 0}if(jt=qt.find(t=>t.is_hovering)?.info,$t.update(t),It)for(let e of xt)e.pos[1]-=.1*t*Math.random(),e.pos[1]<-20&&(e.pos[1]=400)}function pt(t){let e=Et+t;if(0===t&&(e=Lt.findIndex(t=>!t.is_solved)),e<0||e>=Lt.length)return;let i=Lt[e].chapter!==Lt[Et].chapter;i&&Gt(),yt=!0,Et=e,i&&(Bt=at[`welcome${Lt[Et].chapter}`])}function bt(t){let[e,i]=t;if(e-=10,i-=24,!(e<0||e>=224||i<0||i>=224))return e=Math.floor(e/28),i=Math.floor(i/28),[e,i]}function _t(t){return O(t)}function wt(){return _t(function(){let t={};for(let i of xt){let e=bt(i.pos);if(e){let o=i.piece;t[q(...e)]=o}}let e="";for(let i=0;i<8;i++){let o=0;for(let n=0;n<8;n++){let s=q(n,i);t[s]?(o>0&&(e+=o),e+=t[s][0],o=0):o++}o>0&&(e+=o),e+="/"}return e}())}function kt(t){return[t[0]+1,t[1]+1,6,6]}function mt(t){let[e,i]=t.pos;return[e,i,24,24]}function gt(t,e){return{piece:t,pos:e,is_hovering:!1,is_dragging:!1}}let yt,vt,qt,Ct,xt,$t,Mt,Et,Lt=[Tt("5k2/8/8/8/8/8/8/4K3 w - - 0 1",0,0),Tt("5k2/8/8/8/8/8/8/4K3 w - - 0 1",1,0),Tt("5k2/8/8/8/8/8/8/4K3 w - - 0 1",1,1),Tt("5k2/8/8/8/8/8/8/4K3 w - - 0 1",2,0)];function Tt(t,e,i){return{chapter:e,level:i,fen:t,is_solved:!1}}const zt=()=>_t(Lt[Et].fen);let Bt,At,jt,St,Ft,Ot,Dt,Rt,It;function Gt(){xt=[gt("p",[20,0]),gt("n",[52,0]),gt("b",[84,0]),gt("r",[116,0]),gt("q",[148,0]),gt("k",[180,0]),gt("P",[20,248]),gt("N",[52,248]),gt("B",[84,248]),gt("R",[116,248]),gt("Q",[148,248]),gt("K",[180,248])]}!function(t){P=document.createElement("canvas"),P.width=480,P.height=270,P.classList.add("pixelated"),U=P.getContext("2d"),U.imageSmoothingEnabled=!1,U.fillStyle="black",X=document.createElement("canvas"),X.width=1920,X.height=1080,N=X.getContext("2d");let e=document.createElement("div");e.classList.add("content"),e.appendChild(P),e.appendChild(X),t.appendChild(e),It=!1,Dt=!1,Rt=!1,Ot=!1,Ft=0,St=void 0,At=void 0,jt=void 0,Bt=at.welcome0,yt=!0,vt=[],qt=[],Et=0,Ct=void 0,xt=[],Gt(),$t=i(P),Mt=[0,0],function(t,e){const i=1e3/60;let o=performance.now(),n=0;requestAnimationFrame(function s(r){requestAnimationFrame(s);let l=Math.min(r-o,1e3);for(o=r,n+=l;n>=i;)t(i),n-=i;e(n/i)})}(dt,Y)}(document.getElementById("app"));
